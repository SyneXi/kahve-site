<!doctype html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kahve?</title>

  <style>
    :root{
      --bg1:#0f1020; --bg2:#151a33;
      --card:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.72);
      --yes-scale:1;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, #3b82f6 0%, transparent 55%),
        radial-gradient(900px 700px at 90% 30%, #a855f7 0%, transparent 55%),
        linear-gradient(160deg,var(--bg1),var(--bg2));
      overflow:hidden;
    }

    #stage{ position:fixed; inset:0; overflow:hidden; }

    .wrap{ min-height:100%; display:grid; place-items:center; padding:24px; }

    .card{
      width:min(560px,92vw);
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:22px;
      padding:28px 22px;
      backdrop-filter:blur(10px);
      box-shadow:0 18px 60px rgba(0,0,0,.35);
      text-align:center;
      position:relative;
      z-index:2;
    }

    h1{ font-size:clamp(22px,3.2vw,32px); margin:0 0 10px; letter-spacing:.2px; }
    p{ margin:0 0 18px; color:var(--muted); font-size:14px; line-height:1.45; }

    .btnRow{
      display:flex; gap:14px; justify-content:center; align-items:center; flex-wrap:wrap;
      margin-top:10px; position:relative; z-index:5;
    }

    button{
      border:0; border-radius:14px; padding:12px 18px;
      font-weight:700; cursor:pointer; font-size:15px;
      user-select:none; -webkit-tap-highlight-color:transparent;
      transition:filter .15s ease;
    }

    #yes{
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#fff; box-shadow:0 10px 24px rgba(34,197,94,.25);
      position:relative; z-index:30;
    }

    #yes.growing{
      position:absolute;
      left:50%; top:50%;
      transform:translate(-50%,-50%) scale(var(--yes-scale));
      transform-origin:center;
      transition:transform .28s cubic-bezier(.22,.61,.36,1);
      will-change:transform;
      z-index:40;
      border-radius:22px;
      padding:16px 24px;
      font-size:clamp(16px,3vw,28px);
    }

    #no{
      background:linear-gradient(135deg,#ef4444,#dc2626);
      color:#fff; box-shadow:0 10px 24px rgba(239,68,68,.22);
      touch-action:none;
      position:relative; z-index:10;
    }

    #no.fleeing{
      position:absolute; left:0; top:0;
      z-index:20;
      transition:transform .30s cubic-bezier(.22,.61,.36,1);
      will-change:transform;
    }

    .overlay{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      z-index:9999;
      padding:18px;
    }
    .overlay.show{ display:flex; }

    .overlayCard{
      width:min(520px, 92vw);
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.08);
      border-radius:22px;
      box-shadow:0 30px 90px rgba(0,0,0,.55);
      padding:16px;
      text-align:center;
      animation: pop .18s ease-out;
    }
    @keyframes pop{
      from{ transform: scale(.96); opacity:.6; }
      to{ transform: scale(1); opacity:1; }
    }

    .gifWrap{
      display:grid; place-items:center;
      border-radius:18px;
      overflow:hidden;
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.12);
    }
    .gifWrap img{ width:100%; height:auto; display:block; }

    .overlayActions{
      margin-top:12px;
      display:flex;
      justify-content:center;
      gap:10px;
    }
    .closeBtn{
      background:rgba(255,255,255,.10);
      color:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.14);
      padding:10px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:700;
    }
    .closeBtn:hover{ filter:brightness(1.05); }

    #confetti{
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 10050;
      display: none;
    }
    #confetti.show{ display: block; }

    .confetti-piece{
      position: absolute;
      top: -20px;
      width: 10px;
      height: 14px;
      opacity: .95;
      border-radius: 2px;
      animation: fall linear forwards;
      transform: translateY(-20px) rotate(0deg);
    }

    @keyframes fall{
      to{
        transform: translateY(calc(100vh + 60px)) rotate(720deg);
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <div id="stage">
    <div class="wrap">
      <div class="card">
        <h1>Kahve i√ßmeye ne dersin ? ‚òï</h1>

        <div class="btnRow">
          <span id="yesSlot"></span>
          <button id="yes" type="button">Evet</button>

          <span id="noSlot"></span>
          <button id="no" type="button">Hayƒ±r</button>
        </div>
      </div>
    </div>
  </div>

  <div id="confetti"></div>

  <div class="overlay" id="yippeeOverlay" aria-hidden="true">
    <div class="overlayCard" role="dialog" aria-modal="true">
      <div class="gifWrap">
        <img id="yippeeImg" alt="Yippee!" />
      </div>
      <div class="overlayActions">
        <button class="closeBtn" id="closeOverlay" type="button">Kapat</button>
      </div>
    </div>
  </div>

  <script>
    const NOTIFY_URL = "https://kahve-bildir.kerimhuseyin1434.workers.dev/";
    const YIPPEE_GIF_URL = "https://media1.tenor.com/m/RiZpodi6JD0AAAAC/fast-cat-cat-excited.gif";

    const stage = document.getElementById("stage");
    const yesBtn = document.getElementById("yes");
    const noBtn  = document.getElementById("no");
    const yesSlot = document.getElementById("yesSlot");
    const noSlot  = document.getElementById("noSlot");

    const overlay = document.getElementById("yippeeOverlay");
    const yippeeImg = document.getElementById("yippeeImg");
    const closeOverlayBtn = document.getElementById("closeOverlay");

    const confetti = document.getElementById("confetti");

    const PADDING = 14;
    const MIN_DIST = 140;

    let yesInStage = false;
    let noInStage = false;

    let baseScale = 1;
    let proximityBoost = 0;

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    let lastSendAt = 0;
    const SEND_COOLDOWN_MS = 700;

    async function sendNotify(text){
      try{
        const now = Date.now();
        if (now - lastSendAt < SEND_COOLDOWN_MS) return;
        lastSendAt = now;

        await fetch(NOTIFY_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });
      } catch (_) {}
    }

    function ensureYesInStage(){
      if (yesInStage) return;

      const r = yesBtn.getBoundingClientRect();
      yesSlot.style.display = "inline-block";
      yesSlot.style.width = r.width + "px";
      yesSlot.style.height = r.height + "px";

      stage.appendChild(yesBtn);
      yesBtn.classList.add("growing");

      stage.style.setProperty("--yes-scale", "1");
      yesInStage = true;
    }

    function updateYesScale(){
      ensureYesInStage();
      const scale = baseScale * (1 + proximityBoost);
      stage.style.setProperty("--yes-scale", String(scale));
    }

    function growYesPermanently(){
      baseScale *= 1.18;
      updateYesScale();
    }

    function ensureNoInStageStartFromCurrentPosition(){
      if (noInStage) return;

      const btnRectBefore = noBtn.getBoundingClientRect();
      const stageRect = stage.getBoundingClientRect();

      noSlot.style.display = "inline-block";
      noSlot.style.width = btnRectBefore.width + "px";
      noSlot.style.height = btnRectBefore.height + "px";

      stage.appendChild(noBtn);
      noBtn.classList.add("fleeing");

      const startX = btnRectBefore.left - stageRect.left;
      const startY = btnRectBefore.top  - stageRect.top;

      const prev = noBtn.style.transition;
      noBtn.style.transition = "none";
      noBtn.style.transform = `translate(${startX}px, ${startY}px)`;
      void noBtn.offsetHeight;
      noBtn.style.transition = prev;

      noInStage = true;
    }

    function moveNoButton(point){
      ensureNoInStageStartFromCurrentPosition();

      const s = stage.getBoundingClientRect();
      const r = noBtn.getBoundingClientRect();

      const minX = PADDING;
      const minY = PADDING;
      const maxX = s.width  - r.width  - PADDING;
      const maxY = s.height - r.height - PADDING;
      if (maxX <= minX || maxY <= minY) return;

      const px = (point?.x ?? (s.left + s.width / 2)) - s.left;
      const py = (point?.y ?? (s.top  + s.height / 2)) - s.top;

      let x = minX + Math.random() * (maxX - minX);
      let y = minY + Math.random() * (maxY - minY);

      if (Math.abs(x - px) < MIN_DIST) x += (x < px ? -MIN_DIST : MIN_DIST);
      if (Math.abs(y - py) < MIN_DIST) y += (y < py ? -MIN_DIST : MIN_DIST);

      x = clamp(x, minX, maxX);
      y = clamp(y, minY, maxY);

      noBtn.style.transform = `translate(${x}px, ${y}px)`;
    }

    function updateProximityBoost(clientX, clientY){
      const r = noBtn.getBoundingClientRect();
      const cx = r.left + r.width / 2;
      const cy = r.top  + r.height / 2;

      const dx = clientX - cx;
      const dy = clientY - cy;
      const dist = Math.sqrt(dx*dx + dy*dy);

      const nearRadius = 260;
      const p = clamp(1 - (dist / nearRadius), 0, 1);

      proximityBoost = p * 0.60;
      if (yesInStage) updateYesScale();
    }

    function openYippee(){
      const src = YIPPEE_GIF_URL + (YIPPEE_GIF_URL.includes("?") ? "&" : "?") + "t=" + Date.now();
      yippeeImg.src = src;

      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden", "false");
    }

    function closeYippee(){
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden", "true");
      yippeeImg.src = "";
    }

    closeOverlayBtn.addEventListener("click", closeYippee);
    overlay.addEventListener("click", (e) => { if (e.target === overlay) closeYippee(); });
    window.addEventListener("keydown", (e) => { if (e.key === "Escape") closeYippee(); });

    function launchConfetti(count = 120){
      confetti.innerHTML = "";
      confetti.classList.add("show");

      const colors = [
        "#22c55e","#3b82f6","#a855f7","#f59e0b","#ef4444","#06b6d4","#e879f9","#84cc16"
      ];

      for (let i = 0; i < count; i++){
        const el = document.createElement("div");
        el.className = "confetti-piece";

        el.style.left = (Math.random() * 100) + "vw";

        const w = 6 + Math.random() * 10;
        const h = 8 + Math.random() * 14;
        el.style.width = w + "px";
        el.style.height = h + "px";

        el.style.borderRadius = Math.random() > 0.65 ? "999px" : "2px";
        el.style.background = colors[Math.floor(Math.random() * colors.length)];

        const dur = 1.8 + Math.random() * 1.8;
        const delay = Math.random() * 0.2;
        el.style.animationDuration = dur + "s";
        el.style.animationDelay = delay + "s";

        const drift = (Math.random() * 120 - 60);
        el.style.transform = `translate(${drift}px, -20px) rotate(${Math.random()*180}deg)`;

        confetti.appendChild(el);
      }

      setTimeout(() => {
        confetti.classList.remove("show");
        confetti.innerHTML = "";
      }, 3200);
    }

    function getPointFromEvent(e){
      const t = e.touches?.[0];
      const x = t?.clientX ?? e.clientX ?? (window.innerWidth/2);
      const y = t?.clientY ?? e.clientY ?? (window.innerHeight/2);
      return { x, y };
    }

    function onNoAttempt(e){
      if (e.cancelable) e.preventDefault();

      const pt = getPointFromEvent(e);
      growYesPermanently();
      sendNotify("‚ùå <b>HAYIR</b>'a basmaya √ßalƒ±≈ütƒ± üòà");
      moveNoButton(pt);
    }

    yesBtn.addEventListener("click", () => {
      sendNotify("‚úÖ <b>EVET</b>'e basƒ±ldƒ±! ‚òïüéâ");
      openYippee();
      launchConfetti();
    });

    noBtn.addEventListener("pointerdown", onNoAttempt, { passive:false });
    noBtn.addEventListener("touchstart", onNoAttempt, { passive:false });
    noBtn.addEventListener("click", onNoAttempt);
    noBtn.addEventListener("mouseenter", onNoAttempt);

    stage.addEventListener("pointermove", (e) => {
      updateProximityBoost(e.clientX, e.clientY);
    });

    window.addEventListener("resize", () => {
      if (yesInStage) updateYesScale();
    });
  </script>
</body>
</html>
